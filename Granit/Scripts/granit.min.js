$(function(){$.widget("granit.splitter",{options:{direction:"vertical",overflow:"auto",panel:[],splitter:[],panelTemplate:{size:"auto",minSize:5,maxSize:"none",margin:0,flexible:!0,resizable:!0,"class":"granit_panel_default"},splitterTemplate:{width:"2em",length:"100%","class":"granit_splitter_default"},separatorTemplate:{width:"1em",length:"100%","class":"granit_separator_default"},relativeSizeBasedOnRemainingSpace:!1,_throttle:10},_create:function(){var i,r,u,f,s,t,n;self=this;$.granit.splitter.prototype.version="0.1.0.0";i=self.element[0].getAttribute("id");this.IdString="#"+i;var e=["size","minSize","maxSize","margin","flexible","resizable","class"],o=["width","length","class"],h=["display","width","length","class"];granit.listCompare.objectToArray(this.options,["classes","disabled","create","hide","show","direction","overflow","flexible","panel","splitter","panelTemplate","splitterTemplate","separatorTemplate","relativeSizeBasedOnRemainingSpace","_throttle"])||granit.output("invalid options property found - check the options object",this.IdString+" -- options","Warning");self.options.panelTemplate&&!granit.listCompare.objectToArray(self.options.panelTemplate,e,!0)&&granit.output("invalid panel template option property found - check the panel template options",self.IdString+" -- options.panelTemplate","Warning");self.options.splitterTemplate&&!granit.listCompare.objectToArray(self.options.splitterTemplate,o,!0)&&granit.output("invalid splitter template option property found - check the splitter template options",self.IdString+" -- options.splitterTemplate","Warning");self.options.separatorTemplate&&!granit.listCompare.objectToArray(self.options.separatorTemplate,o,!0)&&granit.output("invalid separator template option property found - check the separator template options",self.IdString+" -- options.separatorTemplate","Warning");this.options.panel&&!Array.isArray(this.options.panel)&&granit.output("the options property panel must be an array - check the options object",this.IdString+" -- options.panel");this.options.splitter&&!Array.isArray(this.options.splitter)&&granit.output("the options property splitter must be an array - check the options object",this.IdString+" -- options.splitter");self.options.direction!=="vertical"&&self.options.direction!=="horizontal"&&granit.output("value ("+self.options.direction+") is invalid -- expected values are 'vertical', 'horizontal'",this.IdString+" -- self.options.direction");self.options.overflow!=="auto"&&self.options.overflow!=="hidden"&&self.options.overflow!=="scroll"&&granit.output("value ("+self.options.overflow+") is invalid -- expected values are 'auto', 'hidden', 'scroll'",this.IdString+" -- self.options.overflow");this.element.addClass("granit_container");self.options.direction==="vertical"?(this.element.addClass("granit_container_vertical"),this.element.css("overflow-x",self.options.overflow),this.sizePropertyName="width",this.cursor="ew-resize",this.coordinate="x"):(this.element.addClass("granit_container_horizontal"),this.element.css("overflow-y",self.options.overflow),this.sizePropertyName="height",this.cursor="ns-resize",this.coordinate="y");r=this.element.children("div, article, aside, details, figcaption, figure, footer, header, main, mark, nav, section, summary, time");r.length!=this.element.children("*").length&&granit.output("not all panels are divs or semantic elements!",this.IdString+" -- self.children");u=granit.NumberUnitArray();f=0;this.panels=[];this.relativePanels=[];this.staticPanels=[];this.splitterList=[];this.splitterOffset=granit.NumberUnitArray();this.panelsWithoutSizeTotal=0;r.each(function(n,t){var s=self.options.panel&&self.options.panel[n],d,y,p,g,w,k,o,v,nt,b,tt,a,l,it,c,rt;if(s&&!granit.listCompare.objectToArray(s,e)&&granit.output("invalid panel array item option property found - check the panel array item options",self.IdString+" -- options.panel","Warning"),d=s&&(granit.IsBooleanType(s.resizable)||s.resizable)||self.options.panelTemplate&&self.options.panelTemplate.resizable,d=d?!0:!1,y=s&&s.minSize||self.options.panelTemplate&&self.options.panelTemplate.minSize,y=y&&y!=="none"?granit.extractFloatUnit(y,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel minimum size (minSize)"):new granit.NumberUnit("none"),p=s&&s.maxSize||self.options.panelTemplate&&self.options.panelTemplate.maxSize,p=p&&p!=="none"?granit.extractFloatUnit(p,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel maximum size (maxSize)"):new granit.NumberUnit("none"),g=s&&s.margin||self.options.panelTemplate&&self.options.panelTemplate.margin,g=granit.extractFloatUnit(g,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel margin"),w=(self.options.panelTemplate&&self.options.panelTemplate.class&&" "+self.options.panelTemplate.class||"")+(s&&s.class&&" "+s.class||""),w=granit.uniqueArray(w.split(" ")).join(" "),w="granit_panel"+w,k=s&&(granit.IsBooleanType(s.flexible)||s.flexible)||self.options.panelTemplate&&self.options.panelTemplate.flexible,k=k?!0:!1,n<r.length-1&&(o=self.options.splitter&&self.options.splitter[n],o&&!granit.listCompare.objectToArray(o,h)&&granit.output("invalid splitter array item option property found - check the splitter array item options",self.IdString+" -- options.splitter","Warning"),o&&o.display&&o.display!=="splitter"&&o.display!=="separator"&&granit.output("invalid value '"+self.options.display+"' for the splitter display option",self.IdString+" -- splitter.display","Warning"),v=o&&o.width||(o&&o.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.width:self.options.splitterTemplate&&self.options.splitterTemplate.width),v=granit.extractFloatUnit(v,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- splitter width (splitter.width)"),nt=o&&o.length||(o&&o.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.length:self.options.splitterTemplate&&self.options.splitterTemplate.length),b=(o&&o.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.class&&" "+self.options.separatorTemplate.class||"":self.options.splitterTemplate&&self.options.splitterTemplate.class&&" "+self.options.splitterTemplate.class||"")+(o&&o.class&&" "+o.class||""),b=granit.uniqueArray(b.split(" ")).join(" "),b="granit_splitter"+b,tt=o&&o.display==="separator"?"default":self.cursor,a=$("<div id='granit-"+i+"-splitter-"+(n+1)+"' class='granit_splitter_wrapper' style='cursor:"+tt+";'><\/div>"),a.append("<div class='"+b+"'><\/div>"),self.options.direction==="vertical"?(a.css("width",v.getSize()),a.css("height",nt)):(a.css("height",v.getSize()),a.css("width",nt)),a.data().__granitData__={disabled:o&&o.display==="separator"?!0:!1},self.splitterList[n]=a,v.Value>0&&self.splitterOffset.add(v,"-")),l=$(t),l.is(":data('granit-splitter')")?self.options.direction==="horizontal"&&self.element.css("overflow-y")==="auto"&&(it=new granit.DeviceHelper,it.isIE()&&(self.element.css("overflow-y","hidden"),granit.output("Due to a known but unresolved bug in IE11 and older (Issue #1: IE11 Flexbox Column Children width problem) overflow-y is set to hidden for those Flexbox container columns in order to ensure proper width rendering of its verically arranged children panels",self.IdString+" -- options.overflow","Warning"))):(l.wrap("<div class='"+w+"'><\/div>"),l=l.parent()),c=s&&s.size||self.options.panelTemplate&&self.options.panelTemplate.size||"auto",c!=="auto"&&(c=granit.extractFloatUnit(c,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"%",self.IdString+" -- Panel size (size)")),c=new granit.Size(c),rt="granit_panel_wrapper"+(k?"":" granit_panel_static"),l.wrap("<div id='granit-"+i+"-panel-"+(n+1)+"' class='"+rt+"' style='"+granit.prefixSizeName(self.sizePropertyName,"min")+":"+y.getSize()+";"+granit.prefixSizeName(self.sizePropertyName,"max")+":"+p.getSize()+";'><\/div>"),l.parent().data().__granitData__={index:n,flexible:k,Size:c,resizable:d},self.panels.push(l.parent()),self.splitterList[n]&&self.splitterList[n].insertAfter(l.parent()),!c.autoSized&&(!self.options.relativeSizeBasedOnRemainingSpace||c.Number.Unit!=="%"))return c.Number.Value>0&&u.add(c.Number,"-"),l.parent().css(self.sizePropertyName,c.getSize()),self.staticPanels.push(l.parent()),!0;c.autoSized?self.panelsWithoutSizeTotal++:c.Number.Unit==="%"&&(f+=c.Number.Value);self.relativePanels.push(l.parent())});self.relativePanels.length>0&&(s="(100%"+u.addAll(self.splitterOffset,"-").toString()+")",t=(100-f)/self.panelsWithoutSizeTotal,t<0&&(t=0),self.relativePanels.forEach(function(n){var i=n.data().__granitData__,u="("+(i.Size.autoSized?t:i.Size.Number.Value)+" / 100)",r="calc("+s+" * "+u+")";i.Size.autoSized&&(i.Size.Number.Value=t,i.Size.Number.Unit="%");n.css(self.sizePropertyName,r);i.Size.Number.CalcValue=r}));this.options._throttle=this.options._throttle||10;this.options._throttle!=="none"&&(n={},this.options._throttle==="raf"?(n.modus="raf",n.threshold=20):(n.modus="throttle",n.threshold=parseInt(this.options._throttle),(!n.threshold||n.threshold<=0)&&granit.output("throttle threshold value '"+this.options._throttle+"' is invalid. Allowed are the terms 'none', 'raf' or a positive integer number",this.IdString+" -- options._throttle")),this.MousemoveEventController=new granit.EventTimeController(n.modus,this,n.threshold));this.panels.some(function(n){return n.data().__granitData__.resizable})&&this.splitterList.forEach(function(n){n.data().__granitData__.disabled||self._on(n,{mousedown:"_splitterMouseDown"})})},_elementOnResize:function(n){var t=this.IdString;console.log(t+" Change x: "+n.offsetWidth+", Change y: "+n.offsetHeight)},_elementOnFontResize:function(n,t){var i=this.IdString,r=n.offsetHeight;console.log(i+" Font-Size B: "+t.fontSize+" Height: "+r)},_splitterMouseDown:function(n){var t;if(n.which!==1)return!0;n.stopPropagation();n.preventDefault();t=this;this.movedSplitter=$(n.currentTarget);$(".granit_splitter_wrapper, .granit_panel_wrapper").not(this.movedSplitter).addClass("granit_suppressMouseEvents");this.movedSplitter.addClass("granit_splitter_active");n.target.setCapture&&n.target.setCapture();var i=new granit.PixelConverter(t.element[0]),r=granit.prefixSizeName(t.sizePropertyName,"offset",!0),u=granit.prefixSizeName(t.sizePropertyName,"min"),f=granit.prefixSizeName(t.sizePropertyName,"max");this.panels.forEach(function(n){var s,e,o;if(s=t.options.direction==="vertical"?n.width():n.height(),!n.data().__granitData__.resizable)return!1;e=i.convertToPixel(n[0],u);e&&e==="none"&&(e=0);o=i.convertToPixel(n[0],f);o&&o==="none"&&(o=t.element[0][r]);n.data().__granitData__.minSize=Math.floor(e+1);n.data().__granitData__.maxSize=Math.ceil(o-1);n.data().__granitData__.Size.Pixel=s});i.destroy();this.options.direction==="vertical"?($("html").css("cursor","ew-resize"),this.movedSplitter.data().__granitData__.position=n.pageX):($("html").css("cursor","ns-resize"),this.movedSplitter.data().__granitData__.position=n.pageY);this._on($("html"),{mousemove:"_splitterMouseMove"});this._on($("html"),{mouseup:"_splitterMouseUp"})},_splitterMouseMove:function(n){this.movedSplitter&&(n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault(),this.currentMousePosition={x:n.pageX,y:n.pageY},this.MousemoveEventController&&this.MousemoveEventController.process(this._processPanelMovement)||this._processPanelMovement())},_splitterMouseUp:function(n){var t,o,u,s,h;if(this.movedSplitter&&(n.stopPropagation(),n.preventDefault(),t=this,n.target.releaseCapture&&n.target.releaseCapture(),this.movedSplitter.removeClass("granit_splitter_active"),$(".granit_splitter_wrapper, .granit_panel_wrapper").removeClass("granit_suppressMouseEvents"),$("html").css("cursor","default"),this._off($("html"),"mousemove"),this._off($("html"),"mouseup"),this.MousemoveEventController&&this.MousemoveEventController.cancel(),this.movedSplitter=undefined,t.panels.some(function(n){return n.data().__granitData__.resized}))){var f=new granit.PixelConverter(t.element[0]),i,r,c=granit.prefixSizeName(t.sizePropertyName,"offset",!0),e=granit.NumberUnitArray();panelPixelSizeTotalOffset=0;splitterPixelOffset=0;this.splitterList.forEach(function(n){splitterPixelOffset+=t.options.direction==="vertical"?n.outerWidth():n.outerHeight()});t.staticPanels.length>0&&t.staticPanels.some(function(n){return n.data().__granitData__.resized})&&t.staticPanels.forEach(function(n){if(i=n.data().__granitData__.Size.Pixel,n.data().__granitData__.resized)if(r=n.data().__granitData__.Size.Number.Unit,r==="px")n.data().__granitData__.Size.Number.Value=i;else if(r==="em"||r==="rem"||r==="%"){var u=f.convertFromPixel(i,r,t.sizePropertyName);n.css(t.sizePropertyName,u+r);n.data().__granitData__.Size.Number.Value=u}else n.data().__granitData__.Size.Number.Value=i,n.data().__granitData__.Size.Number.Unit="px";i>0&&(e.add(n.data().__granitData__.Size.Number,"-"),panelPixelSizeTotalOffset+=i)});t.relativePanels.length>0&&t.relativePanels.some(function(n){return n.data().__granitData__.resized})&&(o="(100%"+e.addAll(t.splitterOffset,"-").toString()+")",u=0,u=t.options.direction==="vertical"?t.element.width():t.element.height(),s=u-panelPixelSizeTotalOffset-splitterPixelOffset,h=1,t.relativePanels.forEach(function(n){if(n.data().__granitData__.resized){i=n.data().__granitData__.Size.Pixel;var r=i/s,u="calc("+o+" * "+r+")";n.css(t.sizePropertyName,u);n.data().__granitData__.Size.Number.CalcValue=u;n.data().__granitData__.Size.Number.Value=r*100}}));f.destroy();t.panels.forEach(function(n){t._resetPanelData(n)})}},_resetPanelData:function(n){n.data().__granitData__.flexible&&n.removeClass("granit_panel_static");n.data().__granitData__.minimized=!1;n.data().__granitData__.maximized=!1;n.data().__granitData__.resized=!1},_processPanelMovement:function(){function f(n,t){var f,r,i;if(!t.data().__granitData__.resizable)return null;if(n==="grow"){if(t.data().__granitData__.maximized===!0)return null;r=t.data().__granitData__.maxSize}if(n==="shrink"){if(t.data().__granitData__.minimized===!0)return null;r=t.data().__granitData__.minSize}return(i=t.data().__granitData__.Size.Pixel,n==="grow"&&(f=Math.min(i+Math.abs(u),r)),n==="shrink"&&(f=Math.max(i-Math.abs(u),r)),n==="grow"&&f>i&&i<r||n==="shrink"&&f<i&&i>r)?{panel:t,currentSize:i,limitSize:r,offset:Math.abs(i-f)}:null}var e,n,t,u,i,r;if(this.movedSplitter){if(e=this,u=this.currentMousePosition[this.coordinate]-this.movedSplitter.data().__granitData__.position,this.movedSplitter.data().__granitData__.position=this.currentMousePosition[this.coordinate],u>0){for(i=this.movedSplitter.prev().data().__granitData__.index;i>=0;i--)if(n=f("grow",this.panels[i]),n)break;if(n)for(i=this.movedSplitter.prev().data().__granitData__.index+1;i<this.panels.length;i++)if(t=f("shrink",this.panels[i]),t)break}if(u<0){for(i=this.movedSplitter.next().data().__granitData__.index;i<this.panels.length;i++)if(n=f("grow",this.panels[i]),n)break;if(n)for(i=this.movedSplitter.next().data().__granitData__.index-1;i>=0;i--)if(t=f("shrink",this.panels[i]),t)break}n&&t&&(r=Math.min(n.offset,t.offset),r>=1&&(t.panel.data().__granitData__.resized||(t.panel.hasClass("granit_panel_static")||t.panel.addClass("granit_panel_static"),t.panel.data().__granitData__.resized=!0),t.panel.css(e.sizePropertyName,t.currentSize-r+"px"),n.panel.data().__granitData__.resized||(n.panel.hasClass("granit_panel_static")||n.panel.addClass("granit_panel_static"),n.panel.data().__granitData__.resized=!0),n.panel.css(e.sizePropertyName,n.currentSize+r+"px"),t.panel.data().__granitData__.Size.Pixel=t.currentSize-r,t.panel.data().__granitData__.maximized=!1,n.panel.data().__granitData__.Size.Pixel=n.currentSize+r,n.panel.data().__granitData__.minimized=!1),t.currentSize-r<=t.limitSize&&(t.panel.data().__granitData__.minimized=!0),n.currentSize+r>=n.limitSize&&(n.panel.data().__granitData__.maximized=!0))}}})});