$(function(){$.widget("granit.splitter",{options:{direction:"vertical",overflow:"auto",panel:[],splitter:[],panelTemplate:{size:"auto",minSize:20,maxSize:"none",resizable:!0,flexible:!0,"class":"granit_panel_default"},splitterTemplate:{width:"2em",length:"100%","class":"granit_splitter_default"},separatorTemplate:{width:"1em",length:"100%","class":"granit_separator_default"},reconvert:"default"},_create:function(){var n,i,f,e,t;self=this;$.granit.splitter.prototype.version="0.1.0.0";n=self.element[0].getAttribute("id");this.IdString="#"+n;var r=["size","minSize","maxSize","resizable","flexible","class"],u=["width","length","class"],o=["display","width","length","class"];granit.arrayOperations.compareObjectToArray(this.options,["classes","disabled","create","hide","show","direction","overflow","panel","splitter","panelTemplate","splitterTemplate","separatorTemplate","reconvert"])||granit.output("invalid options property found - check the options object",this.IdString+" -- options","Warning");self.options.panelTemplate&&!granit.arrayOperations.compareObjectToArray(self.options.panelTemplate,r,!0)&&granit.output("invalid panel template option property found - check the panel template options",self.IdString+" -- options.panelTemplate","Warning");self.options.splitterTemplate&&!granit.arrayOperations.compareObjectToArray(self.options.splitterTemplate,u,!0)&&granit.output("invalid splitter template option property found - check the splitter template options",self.IdString+" -- options.splitterTemplate","Warning");self.options.separatorTemplate&&!granit.arrayOperations.compareObjectToArray(self.options.separatorTemplate,u,!0)&&granit.output("invalid separator template option property found - check the separator template options",self.IdString+" -- options.separatorTemplate","Warning");this.options.panel&&!Array.isArray(this.options.panel)&&granit.output("the options property panel must be an array - check the options object",this.IdString+" -- options.panel");this.options.splitter&&!Array.isArray(this.options.splitter)&&granit.output("the options property splitter must be an array - check the options object",this.IdString+" -- options.splitter");self.options.direction!=="vertical"&&self.options.direction!=="horizontal"&&granit.output("value ("+self.options.direction+") is invalid -- expected values are 'vertical', 'horizontal'",this.IdString+" -- self.options.direction","Warning");self.options.overflow!=="auto"&&self.options.overflow!=="hidden"&&self.options.overflow!=="scroll"&&granit.output("value ("+self.options.overflow+") is invalid -- expected values are 'auto', 'hidden', 'scroll'",this.IdString+" -- self.options.overflow","Warning");i=["%","em","rem","cm","mm","in","pt","pc"];self.options.reconvert==="all"&&(self.options.reconvert=i.join("|"));self.options.reconvert==="default"?(f=["%","em"],self.options.reconvert=f.join("|")):self.options.reconvert==="none"?self.options.reconvert==="":granit.arrayOperations.compareArrayToArray(self.options.reconvert.split("|"),i)||granit.output("value ("+self.options.reconvert+") is invalid -- expected values are 'all', 'default', 'none' or some of the following ['%', 'em', 'cm', 'mm', 'in', 'pt', 'pc']",this.IdString+" -- self.options.reconvert","Warning");e=new RegExp(self.options.reconvert);this.element.hasClass("granit-splitter")||this.element.addClass("granit-splitter");self.options.direction==="vertical"?(this.element.addClass("granit_container_vertical"),this.element.css("overflow-x",self.options.overflow),this.sizePropertyName="width",this.cursor="ew-resize",this.coordinate="x"):(this.element.addClass("granit_container_horizontal"),this.element.css("overflow-y",self.options.overflow),this.sizePropertyName="height",this.cursor="ns-resize",this.coordinate="y");t=this.element.children("div, article, aside, details, figcaption, figure, footer, header, main, mark, nav, section, summary, time");t.length!==this.element.children("*").length&&granit.output("not all panels are divs or semantic elements!",this.IdString+" -- self.children","Warning");this.panels=[];this.splitterList=[];t.each(function(i,u){var s=self.options.panel&&self.options.panel[i],w,b,a,v,y,f,k,d,p,it,l,h,rt,c,g,ut;s&&!granit.arrayOperations.compareObjectToArray(s,r)&&granit.output("invalid panel array item option property found - check the panel array item options",self.IdString+" -- options.panel","Warning");w=s&&s.resizable;s&&granit.IsBooleanType(s.resizable)||(w=self.options.panelTemplate&&self.options.panelTemplate.resizable);w=w?!0:!1;b=s&&s.flexible;s&&granit.IsBooleanType(s.flexible)||(b=self.options.panelTemplate&&self.options.panelTemplate.flexible);b=b?!0:!1;a=s&&s.minSize||self.options.panelTemplate&&self.options.panelTemplate.minSize;a=a&&a!=="none"?granit.extractFloatUnit(a,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax/,"px",self.IdString+" -- Panel minimum size (minSize)"):new granit.NumberUnit("none");v=s&&s.maxSize||self.options.panelTemplate&&self.options.panelTemplate.maxSize;v=v&&v!=="none"?granit.extractFloatUnit(v,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax/,"px",self.IdString+" -- Panel maximum size (maxSize)"):new granit.NumberUnit("none");y=(self.options.panelTemplate&&self.options.panelTemplate.class&&" "+self.options.panelTemplate.class||"")+(s&&s.class&&" "+s.class||"");y=granit.arrayOperations.uniqueArray(y.split(" ")).join(" ");y="granit_panel"+y;i<t.length-1&&(f=self.options.splitter&&self.options.splitter[i],f&&!granit.arrayOperations.compareObjectToArray(f,o)&&granit.output("invalid splitter array item option property found - check the splitter array item options",self.IdString+" -- options.splitter","Warning"),f&&f.display&&f.display!=="splitter"&&f.display!=="separator"&&granit.output("invalid value '"+self.options.display+"' for the splitter display option",self.IdString+" -- splitter.display","Warning"),k=f&&f.width||(f&&f.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.width:self.options.splitterTemplate&&self.options.splitterTemplate.width),k=granit.extractFloatUnit(k,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax/,"px",self.IdString+" -- splitter width (splitter.width)"),d=f&&f.length||(f&&f.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.length:self.options.splitterTemplate&&self.options.splitterTemplate.length),p=(f&&f.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.class&&" "+self.options.separatorTemplate.class||"":self.options.splitterTemplate&&self.options.splitterTemplate.class&&" "+self.options.splitterTemplate.class||"")+(f&&f.class&&" "+f.class||""),p=granit.arrayOperations.uniqueArray(p.split(" ")).join(" "),p="granit_splitter"+p,it=f&&f.display==="separator"?"default":self.cursor,l=$("<div id='granit-"+n+"-splitter-"+(i+1)+"' class='granit_splitter_wrapper' style='cursor:"+it+";'><\/div>"),l.append("<div class='"+p+"'><\/div>"),self.options.direction==="vertical"?(l.css("width",k.getSize()),l.css("height",d)):(l.css("height",k.getSize()),l.css("width",d)),l.data().__granitData__={disabled:f&&f.display==="separator"?!0:!1},self.splitterList[i]=l);h=$(u);h.is(":data('granit-splitter')")||h.hasClass("granit-splitter")?self.options.direction==="horizontal"&&self.element.css("overflow-y")==="auto"&&(rt=new granit.DeviceHelper,rt.isIE()&&(self.element.css("overflow-y","hidden"),granit.output("Due to a known but unresolved bug in IE11 and older (Issue #1: IE11 Flexbox Column Children width problem) overflow-y is set to hidden for those Flexbox container columns in order to ensure proper width rendering of its verically arranged children panels",self.IdString+" -- options.overflow","Warning"))):(h.wrap("<div class='"+y+"'><\/div>"),h=h.parent());c=s&&s.size||self.options.panelTemplate&&self.options.panelTemplate.size||1;c==="auto"&&(c=1);c=granit.extractFloatUnit(c,"Q+",/%|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin|vmax/,null,self.IdString+" -- Panel size (size)");c=new granit.Size(c);g=!1;c.Number.Unit.match(e)&&(g=!0);ut="granit_panel_wrapper";h.wrap("<div id='granit-"+n+"-panel-"+(i+1)+"' class='"+ut+"' style='"+granit.prefixSizeName(self.sizePropertyName,"min")+":"+a.getSize()+";'><\/div>");h.parent().data().__granitData__={index:i,Size:c,resizable:w,minSize:a,maxSize:v,reconvert:g};self.panels.push(h.parent());self.splitterList[i]&&self.splitterList[i].insertAfter(h.parent());var nt=c.getSize(),ft="0px",et=0,tt=1;c.Number.Unit?(ft=nt,tt=b?1:0):(et=nt,tt=nt);h.parent().css("flex",et+" "+tt+" "+ft)});this.panels.some(function(n){return n.data().__granitData__.resizable})&&this.splitterList.forEach(function(n){n.data().__granitData__.disabled||self._on(n,{mousedown:"_splitterMouseDown"})})},_elementOnResize:function(n){var t=this.IdString;console.log(t+" Change x: "+n.offsetWidth+", Change y: "+n.offsetHeight)},_elementOnFontResize:function(n,t){var i=this.IdString,r=n.offsetHeight;console.log(i+" Font-Size B: "+t.fontSize+" Height: "+r)},_splitterMouseDown:function(n){var t;if(n.which!==1)return!0;n.stopPropagation();n.preventDefault();t=this;this.movedSplitter=$(n.currentTarget);$(".granit_splitter_wrapper, .granit_panel_wrapper").not(this.movedSplitter).addClass("granit_suppressMouseEvents");this.movedSplitter.addClass("granit_splitter_active");n.target.setCapture&&n.target.setCapture();var i=new granit.PixelConverter(t.element[0]),r=granit.prefixSizeName(t.sizePropertyName,"offset",!0),u=granit.prefixSizeName(t.sizePropertyName,"min"),f=granit.prefixSizeName(t.sizePropertyName,"max");this.panels.forEach(function(n){var h,e,o,s;if(h=t.options.direction==="vertical"?n.width():n.height(),e=n.data().__granitData__,!e.resizable)return!1;o=i.convertToPixel(n[0],u);o&&o==="none"&&(o=0);s=i.convertToPixel(n[0],f);s&&s==="none"&&(s=t.element[0][r]);e.minSize=Math.floor(o+1);e.maxSize=Math.ceil(s-1);n.addClass("granit_panel_static");e.resizable&&(!e.Size.Pixel||Math.abs(e.Size.Pixel-h)>=.01)&&(n.css(t.sizePropertyName,h+"px"),e.Size.Pixel=h,e.resized=!0)});i.destroy();this.options.direction==="vertical"?($("html").css("cursor","ew-resize"),this.movedSplitter.data().__granitData__.position=n.pageX):($("html").css("cursor","ns-resize"),this.movedSplitter.data().__granitData__.position=n.pageY);this._on($("html"),{mousemove:"_splitterMouseMove"});this._on($("html"),{mouseup:"_splitterMouseUp"})},_splitterMouseMove:function(n){this.movedSplitter&&(n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault(),this.currentMousePosition={x:n.pageX,y:n.pageY},this.MousemoveEventController&&this.MousemoveEventController.process(this._processPanelMovement)||this._processPanelMovement())},_splitterMouseUp:function(n){var t,i,r;this.movedSplitter&&(n.stopPropagation(),n.preventDefault(),t=this,n.target.releaseCapture&&n.target.releaseCapture(),this.movedSplitter.removeClass("granit_splitter_active"),$(".granit_splitter_wrapper, .granit_panel_wrapper").removeClass("granit_suppressMouseEvents"),$("html").css("cursor","default"),this._off($("html"),"mousemove"),this._off($("html"),"mouseup"),this.MousemoveEventController&&this.MousemoveEventController.cancel(),this.movedSplitter=undefined,t.panels.some(function(n){return n.data().__granitData__.resized})&&(i=new granit.PixelConverter(t.element[0]),r=granit.prefixSizeName(t.sizePropertyName,"offset",!0),t.panels.forEach(function(n){var r=n.data().__granitData__,u=r.Size.Pixel,e=r.Size.Number.Unit,f;r.resized&&(r.reconvert?(f=i.convertFromPixel(u,e,t.sizePropertyName),r.Size=f,u=f.getSize()):(e||r.Size.Number.Value===1||(n.css("flex","1 1 0px"),r.Size.Number.Value=1),u+="px"),n.css("flex-basis",u))}),i.destroy()),t.panels.forEach(function(n){t._resetPanelData(n)}))},_resetPanelData:function(n){n.removeClass("granit_panel_static");n.data().__granitData__.minimized=!1;n.data().__granitData__.maximized=!1;n.data().__granitData__.resized=!1},_processPanelMovement:function(){function f(n,t){var f,r,i;if(!t.data().__granitData__.resizable)return null;if(n==="grow"){if(t.data().__granitData__.maximized===!0)return null;r=t.data().__granitData__.maxSize}if(n==="shrink"){if(t.data().__granitData__.minimized===!0)return null;r=t.data().__granitData__.minSize}return(i=t.data().__granitData__.Size.Pixel,n==="grow"&&(f=Math.min(i+Math.abs(u),r)),n==="shrink"&&(f=Math.max(i-Math.abs(u),r)),n==="grow"&&f>i&&i<r||n==="shrink"&&f<i&&i>r)?{panel:t,currentSize:i,limitSize:r,offset:Math.abs(i-f)}:null}var e,n,i,u,t,r;if(this.movedSplitter){if(e=this,u=this.currentMousePosition[this.coordinate]-this.movedSplitter.data().__granitData__.position,this.movedSplitter.data().__granitData__.position=this.currentMousePosition[this.coordinate],u>0){for(t=this.movedSplitter.prev().data().__granitData__.index;t>=0;t--)if(n=f("grow",this.panels[t]),n)break;if(n)for(t=this.movedSplitter.prev().data().__granitData__.index+1;t<this.panels.length;t++)if(i=f("shrink",this.panels[t]),i)break}if(u<0){for(t=this.movedSplitter.next().data().__granitData__.index;t<this.panels.length;t++)if(n=f("grow",this.panels[t]),n)break;if(n)for(t=this.movedSplitter.next().data().__granitData__.index-1;t>=0;t--)if(i=f("shrink",this.panels[t]),i)break}n&&i&&(r=Math.min(n.offset,i.offset),r>=1&&(i.panel.data().__granitData__.resized=!0,i.panel.css(e.sizePropertyName,i.currentSize-r+"px"),n.panel.data().__granitData__.resized=!0,n.panel.css(e.sizePropertyName,n.currentSize+r+"px"),i.panel.data().__granitData__.Size.Pixel=i.currentSize-r,i.panel.data().__granitData__.maximized=!1,n.panel.data().__granitData__.Size.Pixel=n.currentSize+r,n.panel.data().__granitData__.minimized=!1),i.currentSize-r<=i.limitSize&&(i.panel.data().__granitData__.minimized=!0),n.currentSize+r>=n.limitSize&&(n.panel.data().__granitData__.maximized=!0))}}})});