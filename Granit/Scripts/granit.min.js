$((function(){$.widget("granit.splitter",{options:{classes:{granit_splitter_panel:"ui-widget-content",granit_splitter:"ui-state-default",granit_splitter_hover:"ui-state-hover",granit_splitter_active:"ui-state-active"},direction:void 0,overflow:"auto",panel:[],splitter:[],panelTemplate:{size:"auto",minSize:30,maxSize:"none",resizable:!0,flexible:!0},splitterTemplate:{len:"100%",width:"6px",marge:0,disabled:!1}},_create:function(){self=this,$.granit.splitter.prototype.version="0.1.0.0";var splitterId=self.element[0].getAttribute("id");this.IdString="#"+splitterId;var optionsAllowed=["classes","disabled","create","hide","show","direction","overflow","panel","splitter","panelTemplate","splitterTemplate"],panelOptionsAllowed=["index","size","minSize","maxSize","resizable","flexible","class"],splitterOptionsAllowed=["index","disabled","width","len","marge","class"];granit.arrayOperations.compareObjectToArray(this.options,optionsAllowed)||granit.output("invalid options property found - check the options object",this.IdString+" -- options","Warning"),self.options.panelTemplate&&!granit.arrayOperations.compareObjectToArray(self.options.panelTemplate,panelOptionsAllowed)&&granit.output("invalid panel template option property found - check the panel template options",self.IdString+" -- options.panelTemplate","Warning"),self.options.splitterTemplate&&!granit.arrayOperations.compareObjectToArray(self.options.splitterTemplate,splitterOptionsAllowed)&&granit.output("invalid splitter template option property found - check the splitter template options",self.IdString+" -- options.splitterTemplate","Warning"),this.options.panel&&!Array.isArray(this.options.panel)&&granit.output("the options property panel must be an array - check the options object",this.IdString+" -- options.panel"),this.options.splitter&&!Array.isArray(this.options.splitter)&&granit.output("the options property splitter must be an array - check the options object",this.IdString+" -- options.splitter"),self.options.direction||(this.element.hasClass("granit_layout_vertical")?self.options.direction="vertical":this.element.hasClass("granit_layout_horizontal")&&(self.options.direction="horizontal")),"vertical"!==self.options.direction&&"horizontal"!==self.options.direction&&granit.output("value ("+self.options.direction+") is invalid -- expected values are 'vertical', 'horizontal'",this.IdString+" -- self.options.direction","Warning"),"auto"!==self.options.overflow&&"hidden"!==self.options.overflow&&"scroll"!==self.options.overflow&&granit.output("value ("+self.options.overflow+") is invalid -- expected values are 'auto', 'hidden', 'scroll'",this.IdString+" -- self.options.overflow","Warning");var units=["%","vmin","vmax","rem","em","px","ex","ch","cm","mm","in","pt","pc","vh","vw"];this.unitsRegex=new RegExp(units.join("|")),this.element.hasClass("granit_layout")||this._addClass("granit_layout"),"vertical"===self.options.direction?(this.element.removeClass("granit_layout_horizontal"),this.element.hasClass("granit_layout_vertical")||this.element.addClass("granit_layout_vertical"),this.element.css("overflow-x",self.options.overflow),this.sizePropertyName="width",this.cursor="ew-resize",this.coordinate="x"):(this.element.removeClass("granit_layout_vertical"),this.element.hasClass("granit_layout_horizontal")||this.element.addClass("granit_layout_horizontal"),this.element.css("overflow-y",self.options.overflow),this.sizePropertyName="height",this.cursor="ns-resize",this.coordinate="y");var children=this.element.children("div, article, aside, details, figcaption, figure, footer, header, main, mark, nav, section, summary, time");children.length!==this.element.children("*").length&&granit.output("not all panels are divs or semantic elements!",this.IdString+" -- self.children","Warning"),this.panels=[],this.splitterList=[];var existsFlexiblePanel=!1;children.each((function(index,element){var panel=self.options.panel&&$.grep(self.options.panel,(function(x){return x.index==index}))[0]||self.options.panelTemplate;panel&&!granit.arrayOperations.compareObjectToArray(panel,panelOptionsAllowed)&&granit.output("invalid panel array item option property found - check the panel array item options",self.IdString+" -- options.panel","Warning");var resizable=panel&&panel.resizable;panel&&granit.IsBooleanType(panel.resizable)||(resizable=self.options.panelTemplate&&self.options.panelTemplate.resizable),resizable=!!resizable;var flexible=panel&&panel.flexible;panel&&granit.IsBooleanType(panel.flexible)||(flexible=self.options.panelTemplate&&self.options.panelTemplate.flexible),flexible=!!flexible;var minSize=panel&&panel.minSize||self.options.panelTemplate&&self.options.panelTemplate.minSize;minSize=minSize&&"none"!==minSize?granit.extractFloatUnit(minSize,"Q+",self.unitsRegex,"px",self.IdString+" -- Panel minimum size (minSize)"):new granit.NumberUnit("none");var maxSize=panel&&panel.maxSize||self.options.panelTemplate&&self.options.panelTemplate.maxSize;if(maxSize=maxSize&&"none"!==maxSize?granit.extractFloatUnit(maxSize,"Q+",self.unitsRegex,"px",self.IdString+" -- Panel maximum size (maxSize)"):new granit.NumberUnit("none"),index<children.length-1){var splitter=self.options.splitter&&$.grep(self.options.splitter,(function(x){return x.index==index}))[0]||self.options.splitterTemplate;splitter&&!granit.arrayOperations.compareObjectToArray(splitter,splitterOptionsAllowed)&&granit.output("invalid splitter array item option property found - check the splitter array item options",self.IdString+" -- options.splitter","Warning");var disabled=splitter&&splitter.disabled;splitter&&granit.IsBooleanType(splitter.disabled)||(disabled=self.options.splitterTemplate&&self.options.splitterTemplate.disabled),disabled=!!disabled;var splitterWidth=splitter&&splitter.width||self.options.splitterTemplate&&self.options.splitterTemplate.width;splitterWidth=granit.extractFloatUnit(splitterWidth,"Q+",self.unitsRegex,"px",self.IdString+" -- splitter width (splitter.width)");var splitterLen=splitter&&splitter.len||self.options.splitterTemplate&&self.options.splitterTemplate.len,splitterMarge=splitter&&splitter.marge||self.options.splitterTemplate&&self.options.splitterTemplate.marge,cursor=splitter&&splitter.disabled?"default":self.cursor,splitterElement=$("<div></div>");self._addClass(splitterElement,"granit_splitter",splitter.class||self.options.splitterTemplate.class),splitterElement.wrap("<div id='granit-"+splitterId+"-splitter-"+(index+1)+"' class='granit_splitter_wrapper' style='cursor:"+cursor+";'></div>"),"vertical"===self.options.direction?(splitterElement.addClass("granit_splitter_vertical"),splitterElement.parent().css("width",splitterWidth.getValue()),splitterElement.parent().css("height",splitterLen),splitterElement.css({marginLeft:splitterMarge,marginRight:splitterMarge})):(splitterElement.addClass("granit_splitter_horizontal"),splitterElement.parent().css("height",splitterWidth.getValue()),splitterElement.parent().css("width",splitterLen),splitterElement.css({marginTop:splitterMarge,marginBottom:splitterMarge})),splitterElement.parent().data().__granitData__={disabled:splitter&&splitter.disabled},self.splitterList[index]=splitterElement.parent()}var wrappedElement=$(element),dh;wrappedElement.is("[class^=granit_layout]")?"horizontal"===self.options.direction&&"auto"===self.element.css("overflow-y")&&(new granit.DeviceHelper).isIE()&&self.element.css("overflow-y","hidden"):(wrappedElement.wrap("<div></div>"),wrappedElement=wrappedElement.parent(),self._addClass(wrappedElement,"granit_splitter_panel",panel.class||self.options.panelTemplate.class));var size=panel&&panel.size||self.options.panelTemplate&&self.options.panelTemplate.size||1;"auto"===size&&(size=1),size=granit.extractFloatUnit(size,"Q+",self.unitsRegex,null,self.IdString+" -- Panel size (size)"),size=new granit.Size(size);var panelWrapperClass="granit_panel_wrapper",basis,grow,shrink;wrappedElement.wrap("<div id='granit-"+splitterId+"-panel-"+(index+1)+"' class='"+panelWrapperClass+"' style='"+granit.prefixSizeName(self.sizePropertyName,"min")+":"+minSize.getValue()+";'></div>"),wrappedElement=wrappedElement.parent(),size.AutoSized?(basis=size.AutoSized?0:size.getValue(),grow=size.AutoSized?size.getValue():0,shrink=size.AutoSized?size.getValue():flexible?1:0):(basis=size.getValue(),grow=0,shrink=flexible?1:0),wrappedElement.css("flex",grow+" "+shrink+" "+basis),self.splitterList[index]&&!parseFloat(getComputedStyle(self.splitterList[index].children(0)[0],null).getPropertyValue("margin"))&&self.splitterList[index].children(0).addClass("granit_splitter_noBorder"),wrappedElement.data().__granitData__={index:index,Size:size,flexible:flexible,resizable:resizable,minSize:minSize,maxSize:maxSize},self.panels.push(wrappedElement),self.splitterList[index]&&self.splitterList[index].insertAfter(wrappedElement)})),self.panels.some((function(item,index){return item.data().__granitData__.resizable}))&&self.splitterList.forEach((function(item,index){item.data().__granitData__.disabled||(self._on(item,{mousedown:"_splitterMouseDown"}),item.hover((function(){self._toggleClass($(this).children(0),"granit_splitter_hover")})))})),self.panels.forEach((function(item,index){var data=item.data().__granitData__;if(data.Size.AutoSized){var size,basis=(size="vertical"===self.options.direction?item.width():item.height())+"px",grow=data.Size.getValue(),shrink=data.Size.getValue();item.css("flex",grow+" "+shrink+" "+basis)}}))},_elementOnResize:function(element){var id=this.IdString;console.log(id+" Change x: "+element.offsetWidth+", Change y: "+element.offsetHeight)},_elementOnFontResize:function(element,size){var id=this.IdString,height=element.offsetHeight;console.log(id+" Font-Size B: "+size.fontSize+" Height: "+height)},_splitterMouseDown:function(event){if(1!==event.which)return!0;event.stopPropagation(),event.preventDefault();var self=this;this.movedSplitter=$(event.currentTarget),$(".granit_splitter_wrapper, .granit_panel_wrapper").not(this.movedSplitter).addClass("granit_suppressMouseEvents"),this.movedSplitter.addClass("granit_splitter_active"),this._addClass(this.movedSplitter.children(0),"granit_splitter_active"),event.target.setCapture&&event.target.setCapture();var pc=new granit.PixelConverter(self.element[0]),offsetSizeName=granit.prefixSizeName(self.sizePropertyName,"offset",!0),minSizeName=granit.prefixSizeName(self.sizePropertyName,"min"),maxSizeName=granit.prefixSizeName(self.sizePropertyName,"max");this.panels.forEach((function(item,index){var size;size="vertical"===self.options.direction?item.width():item.height();var itemData=item.data().__granitData__;if(itemData.resizable){var minSize=pc.convertToPixel(item[0],minSizeName,!1);minSize&&"none"===minSize&&(minSize=0);var maxSize=pc.convertToPixel(item[0],maxSizeName,!1);maxSize&&"none"===maxSize&&(maxSize=self.element[0][offsetSizeName]),itemData.minSize=Math.floor(minSize+1),itemData.maxSize=Math.ceil(maxSize-1),itemData.Size.Pixel=size,item.css("flex","none"),item.css(self.sizePropertyName,size+"px"),itemData.resized=!0}})),pc.destroy(),"vertical"===this.options.direction?($("html").css("cursor","ew-resize"),this.movedSplitter.data().__granitData__.position=event.pageX):($("html").css("cursor","ns-resize"),this.movedSplitter.data().__granitData__.position=event.pageY),this._on($("html"),{mousemove:"_splitterMouseMove"}),this._on($("html"),{mouseup:"_splitterMouseUp"})},_splitterMouseMove:function(event){this.movedSplitter&&(event.stopPropagation(),event.stopImmediatePropagation(),event.preventDefault(),this.currentMousePosition={x:event.pageX,y:event.pageY},this.MousemoveEventController&&this.MousemoveEventController.process(this._processPanelMovement)||this._processPanelMovement())},_splitterMouseUp:function(event){if(this.movedSplitter){event.stopPropagation(),event.preventDefault();var self=this;if(event.target.releaseCapture&&event.target.releaseCapture(),this.movedSplitter.removeClass("granit_splitter_active"),this._removeClass(this.movedSplitter.children(0),"granit_splitter_active"),$(".granit_splitter_wrapper, .granit_panel_wrapper").removeClass("granit_suppressMouseEvents"),$("html").css("cursor","default"),this._off($("html"),"mousemove"),this._off($("html"),"mouseup"),this.MousemoveEventController&&this.MousemoveEventController.cancel(),this.movedSplitter=void 0,self.panels.some((function(item){return item.data().__granitData__.resized}))){var pc=new granit.PixelConverter(self.element[0]);self.panels.forEach((function(item,index){var data=item.data().__granitData__,basis,grow,shrink;data.resized&&(data.Size.AutoSized||pc.convertFromPixel(data.Size,self.sizePropertyName,!1),data.Size.AutoSized?(basis=data.Size.getValue(data.Size.AutoSized),grow=data.Size.AutoSized?data.Size.getValue():0,shrink=data.Size.AutoSized?data.Size.getValue():data.flexible?1:0):(basis=data.Size.getValue(),grow=0,shrink=data.flexible?1:0),item.css("flex",grow+" "+shrink+" "+basis),data.minimized=!1,data.maximized=!1,data.resized=!1)})),pc.destroy()}}},_processPanelMovement:function(){if(this.movedSplitter){var self=this,growResult,shrinkResult,distance=this.currentMousePosition[this.coordinate]-this.movedSplitter.data().__granitData__.position;if(this.movedSplitter.data().__granitData__.position=this.currentMousePosition[this.coordinate],distance>0){for(var pointer=this.movedSplitter.prev().data().__granitData__.index;pointer>=0&&!(growResult=test("grow",this.panels[pointer]));pointer--);if(growResult)for(pointer=this.movedSplitter.prev().data().__granitData__.index+1;pointer<this.panels.length&&!(shrinkResult=test("shrink",this.panels[pointer]));pointer++);}if(distance<0){for(pointer=this.movedSplitter.next().data().__granitData__.index;pointer<this.panels.length&&!(growResult=test("grow",this.panels[pointer]));pointer++);if(growResult)for(pointer=this.movedSplitter.next().data().__granitData__.index-1;pointer>=0&&!(shrinkResult=test("shrink",this.panels[pointer]));pointer--);}if(growResult&&shrinkResult){var offset=Math.min(growResult.offset,shrinkResult.offset);offset>=1&&(shrinkResult.panel.data().__granitData__.resized=!0,shrinkResult.panel.css(this.sizePropertyName,shrinkResult.currentSize-offset+"px"),growResult.panel.data().__granitData__.resized=!0,growResult.panel.css(this.sizePropertyName,growResult.currentSize+offset+"px"),shrinkResult.panel.data().__granitData__.Size.Pixel=shrinkResult.currentSize-offset,shrinkResult.panel.data().__granitData__.maximized=!1,growResult.panel.data().__granitData__.Size.Pixel=growResult.currentSize+offset,growResult.panel.data().__granitData__.minimized=!1),shrinkResult.currentSize-offset<=shrinkResult.limitSize&&(shrinkResult.panel.data().__granitData__.minimized=!0),growResult.currentSize+offset>=growResult.limitSize&&(growResult.panel.data().__granitData__.maximized=!0)}}function test(modus,panel){var newSize,limitSize;if(!panel.data().__granitData__.resizable)return null;if("grow"===modus){if(!0===panel.data().__granitData__.maximized)return null;limitSize=panel.data().__granitData__.maxSize}if("shrink"===modus){if(!0===panel.data().__granitData__.minimized)return null;limitSize=panel.data().__granitData__.minSize}var currentSize=panel.data().__granitData__.Size.Pixel;return"grow"===modus&&(newSize=Math.min(currentSize+Math.abs(distance),limitSize)),"shrink"===modus&&(newSize=Math.max(currentSize-Math.abs(distance),limitSize)),"grow"===modus&&newSize>currentSize&&currentSize<limitSize||"shrink"===modus&&newSize<currentSize&&currentSize>limitSize?{panel:panel,currentSize:currentSize,limitSize:limitSize,offset:Math.abs(currentSize-newSize)}:null}}})}));