$(function(){$.widget("granit.splitter",{options:{direction:"vertical",overflow:"auto",panel:[],splitter:[],panelTemplate:{size:"auto",minSize:5,maxSize:"none",padding:0,margin:0,flexible:!0,resizable:!0,classes:"granit_Panel_Default"},splitterTemplate:{width:"0.5em",length:"100%",classes:"granit_Splitter_Default"},separatorTemplate:{width:"0.5em",length:"100%",classes:"granit_Separator_Default"},relativeSizeBasedOnRemainingSpace:!1,_throttle:10},_create:function(){var t,i,l,r,n;self=this;$.granit.splitter.prototype.version="0.1.0.0";t=self.element[0].getAttribute("id");this.IdString="#"+t;var f=["size","minSize","maxSize","padding","margin","flexible","resizable","classes"],e=["width","length","classes"],a=["display","width","length","classes"];granit.listCompare.objectToArray(this.options,["classes","disabled","create","hide","show","direction","overflow","flexible","panel","splitter","panelTemplate","splitterTemplate","separatorTemplate","relativeSizeBasedOnRemainingSpace","_throttle"])||granit.output("invalid options property found - check the options object",this.IdString+" -- options","Warning");self.options.panelTemplate&&!granit.listCompare.objectToArray(self.options.panelTemplate,f,!0)&&granit.output("invalid panel template option property found - check the panel template options",self.IdString+" -- options.panelTemplate","Warning");self.options.splitterTemplate&&!granit.listCompare.objectToArray(self.options.splitterTemplate,e,!0)&&granit.output("invalid splitter template option property found - check the splitter template options",self.IdString+" -- options.splitterTemplate","Warning");self.options.separatorTemplate&&!granit.listCompare.objectToArray(self.options.separatorTemplate,e,!0)&&granit.output("invalid separator template option property found - check the separator template options",self.IdString+" -- options.separatorTemplate","Warning");this.options.panel&&!Array.isArray(this.options.panel)&&granit.output("the options property panel must be an array - check the options object",this.IdString+" -- options.panel");this.options.splitter&&!Array.isArray(this.options.splitter)&&granit.output("the options property splitter must be an array - check the options object",this.IdString+" -- options.splitter");self.options.direction!=="vertical"&&self.options.direction!=="horizontal"&&granit.output("value ("+self.options.direction+") is invalid -- expected values are 'vertical', 'horizontal'",this.IdString+" -- self.options.direction");self.options.overflow!=="auto"&&self.options.overflow!=="hidden"&&self.options.overflow!=="scroll"&&granit.output("value ("+self.options.overflow+") is invalid -- expected values are 'auto', 'hidden', 'scroll'",this.IdString+" -- self.options.overflow");this.element.addClass("granitSplitter_Container");self.options.direction==="vertical"?(this.element.addClass("granitSplitter_Container_vertical"),this.element.css("overflow-x",self.options.overflow),this.sizePropertyName="width",this.cursor="ew-resize",this.coordinate="x"):(this.element.addClass("granitSplitter_Container_horizontal"),this.element.css("overflow-y",self.options.overflow),this.sizePropertyName="height",this.cursor="ns-resize",this.coordinate="y");i=this.element.children("div, article, aside, details, figcaption, figure, footer, header, main, mark, nav, section, summary, time");i.length!=this.element.children("*").length&&granit.output("not all panels are divs or semantic elements!",this.IdString+" -- self.children");var u=[],o=granit.NumberUnitArray(),s=0,h=0,c=granit.NumberUnitArray();this.panels=[];this.splitterList=[];i.each(function(n,r){var l=self.options.panel&&self.options.panel[n],tt,p,w,it,b,g,nt,e,k,rt,d,ut,ft,v,et,y,ot;if(l&&!granit.listCompare.objectToArray(l,f)&&granit.output("invalid panel array item option property found - check the panel array item options",self.IdString+" -- options.panel","Warning"),tt=l&&l.resizable||self.options.panelTemplate&&self.options.panelTemplate.resizable,tt=tt?!0:!1,p=l&&l.minSize||self.options.panelTemplate&&self.options.panelTemplate.minSize,p=p&&p!=="none"?granit.extractFloatUnit(p,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel minimum size (minSize)"):new granit.NumberUnit("none"),w=l&&l.maxSize||self.options.panelTemplate&&self.options.panelTemplate.maxSize,w=w&&w!=="none"?granit.extractFloatUnit(w,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel maximum size (maxSize)"):new granit.NumberUnit("none"),it=l&&l.padding||self.options.panelTemplate&&self.options.panelTemplate.padding,it=granit.extractFloatUnit(it,"Q+",/px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel padding"),b=l&&l.margin||self.options.panelTemplate&&self.options.panelTemplate.margin,b=granit.extractFloatUnit(b,"Q+",/px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- Panel margin"),g=(self.options.panelTemplate&&self.options.panelTemplate.classes&&" "+self.options.panelTemplate.classes||"")+(l&&l.classes&&" "+l.classes||""),g=granit.uniqueArray(g.split(" ")).join(" "),g="granit_Panel_wrapper"+g,nt=l&&l.flexible||self.options.panelTemplate&&self.options.panelTemplate.flexible,nt=nt?!0:!1,n<i.length-1&&(e=self.options.splitter&&self.options.splitter[n],e&&!granit.listCompare.objectToArray(e,a)&&granit.output("invalid splitter array item option property found - check the splitter array item options",self.IdString+" -- options.splitter","Warning"),e&&e.display&&e.display!=="splitter"&&e.display!=="separator"&&granit.output("invalid value '"+self.options.display+"' for the splitter display option",self.IdString+" -- splitter.display","Warning"),k=e&&e.width||(e&&e.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.width:self.options.splitterTemplate&&self.options.splitterTemplate.width),k=granit.extractFloatUnit(k,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"px",self.IdString+" -- splitter width (splitter.width)"),rt=e&&e.length||(e&&e.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.length:self.options.splitterTemplate&&self.options.splitterTemplate.length),d=(e&&e.display==="separator"?self.options.separatorTemplate&&self.options.separatorTemplate.classes&&" "+self.options.separatorTemplate.classes||"":self.options.splitterTemplate&&self.options.splitterTemplate.classes&&" "+self.options.splitterTemplate.classes||"")+(e&&e.classes&&" "+e.classes||""),d=granit.uniqueArray(d.split(" ")).join(" "),d="granitSplitter_Splitter"+d,ut=e&&e.display==="separator"?"default":self.cursor,ft=self.options.direction==="vertical"?$("<div id='granit-"+t+"-splitter-"+(n+1)+"' class='"+d+"' style='width:"+k.getSize()+";height:"+rt+";cursor:"+ut+";'><\/div>"):$("<div id='granit-"+t+"-splitter-"+(n+1)+"' class='"+d+"' style='width:"+rt+";height:"+k.getSize()+";cursor:"+ut+";'><\/div>"),ft.data().__granitData__={disabled:e&&e.display==="separator"?!0:!1},self.splitterList[n]=ft,k.Number>0&&c.add(k,"-")),v=$(r),v.is(":data('granit-splitter')")?self.options.direction==="horizontal"&&self.element.css("overflow-y")==="auto"&&(et=new granit.DeviceHelper,et.isIE()&&(self.element.css("overflow-y","hidden"),granit.output("Due to a known but unresolved bug in IE11 and older (Issue #1: IE11 Flexbox Column Children width problem) overflow-y is set to hidden for those Flexbox container columns in order to ensure proper width rendering of its verically arranged children panels",self.IdString+" -- options.overflow","Warning"))):(v.wrap("<div class='"+g+"'><\/div>"),v=v.parent(),v.css("padding",it.getSize()),v.css("margin",b.getSize()),b.Number>0?v.css("height","calc(100% - "+2*b.Number+b.Unit+")"):v.css("height","100%")),y=l&&l.size||self.options.panelTemplate&&self.options.panelTemplate.size||"auto",y!=="auto"&&(y=granit.extractFloatUnit(y,"Q+",/%|px|em|ex|px|cm|mm|in|pt|pc|ch|rem|vh|vw|vmin/,"%",self.IdString+" -- Panel size (size)")),y!=="auto"&&(!self.options.relativeSizeBasedOnRemainingSpace||y.Unit!=="%"))return ot="granit_Panel"+(nt?"":" granit_Panel_Static"),y.Number>0&&o.add(y,"-"),v.wrap("<div id='granit-"+t+"-panel-"+(n+1)+"' class='"+ot+"' style='"+self.sizePropertyName+":"+y.getSize()+";"+granit.prefixSizeName(self.sizePropertyName,"min")+":"+p.getSize()+";"+granit.prefixSizeName(self.sizePropertyName,"max")+":"+w.getSize()+";'><\/div>"),v.parent().data().__granitData__={index:n,flexible:nt,originalUnit:y.Unit,resizable:tt},self.panels.splice(n,0,v.parent()),self.splitterList[n]&&self.splitterList[n].insertAfter(v.parent()),!0;y==="auto"?h++:y.Unit==="%"&&(s+=y.Number);u.push({size:y,index:n,flexible:nt,wrappedElement:v,minSize:p.getSize(),maxSize:w.getSize(),resizable:tt})});u.length>0&&(l="(100%"+o.addAll(c,"-").toString()+")",r=(100-s)/h,r<0&&(r=0),u.forEach(function(n){var i="("+(n.size!=="auto"?n.size.Number:r)+" / 100)",u="calc("+l+" * "+i+")",f="granit_Panel"+(n.flexible?"":" granit_Panel_Static");n.wrappedElement.wrap("<div id='granit-"+t+"-panel-"+(n.index+1)+"' class='"+f+"' style='"+self.sizePropertyName+":"+u+";"+granit.prefixSizeName(self.sizePropertyName,"min")+":"+n.minSize+";"+granit.prefixSizeName(self.sizePropertyName,"max")+":"+n.maxSize+";'><\/div>");n.wrappedElement.parent().data().__granitData__={index:n.index,flexible:n.flexible,originalUnit:"%",resizable:n.resizable};self.panels.splice(n.index,0,n.wrappedElement.parent());self.splitterList[n.index]&&self.splitterList[n.index].insertAfter(n.wrappedElement.parent())}));this.options._throttle=this.options._throttle||10;this.options._throttle!=="none"&&(n={},this.options._throttle==="raf"?(n.modus="raf",n.threshold=20):(n.modus="throttle",n.threshold=parseInt(this.options._throttle),(!n.threshold||n.threshold<=0)&&granit.output("throttle threshold value '"+this.options._throttle+"' is invalid. Allowed are the terms 'none', 'raf' or a positive integer number",this.IdString+" -- options._throttle")),this.MousemoveEventController=new granit.EventTimeController(n.modus,this,n.threshold));this.panels.some(function(n){return n.data().__granitData__.resizable})&&this.splitterList.forEach(function(n){n.data().__granitData__.disabled||self._on(n,{mousedown:"_splitterMouseDown"})})},_elementOnResize:function(n){var t=this.IdString;console.log(t+" Change x: "+n.offsetWidth+", Change y: "+n.offsetHeight)},_elementOnFontResize:function(n,t){var i=this.IdString,r=n.offsetHeight;console.log(i+" Font-Size B: "+t.fontSize+" Height: "+r)},_splitterMouseDown:function(n){var t;if(n.which!==1)return!0;n.stopPropagation();n.preventDefault();t=this;this.movedSplitter=$(n.target);n.target.setCapture&&n.target.setCapture();var i=new granit.PixelConverter(t.element[0]),r=granit.prefixSizeName(t.sizePropertyName,"offset",!0),u=granit.prefixSizeName(t.sizePropertyName,"min"),f=granit.prefixSizeName(t.sizePropertyName,"max");this.panels.forEach(function(n){var s,e,o;if(s=t.options.direction==="vertical"?n.width():n.height(),n.hasClass("granit_Panel_Static")||n.addClass("granit_Panel_Static"),n.css(t.sizePropertyName,s+"px"),!n.data().__granitData__.resizable)return!1;e=i.convertToPixel(n[0],u);e&&e==="none"&&(e=0);o=i.convertToPixel(n[0],f);o&&o==="none"&&(o=t.element[0][r]);n.data().__granitData__.minSize=e;n.data().__granitData__.maxSize=o;n.data().__granitData__.size=s});i.destroy();this.options.direction==="vertical"?($("html").css("cursor","ew-resize"),this.movedSplitter.data().__granitData__.position=n.pageX):($("html").css("cursor","ns-resize"),this.movedSplitter.data().__granitData__.position=n.pageY);this._on($("html"),{mousemove:"_splitterMouseMove"});this._on($("html"),{mouseup:"_splitterMouseUp"})},_splitterMouseMove:function(n){(n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault(),this.movedSplitter)&&(this.currentMousePosition={x:n.pageX,y:n.pageY},this.MousemoveEventController&&this.MousemoveEventController.process(this._processPanelMovement)||this._processPanelMovement())},_splitterMouseUp:function(n){var i,r,u,t;this.movedSplitter&&(n.stopPropagation(),n.preventDefault(),i=this,n.target.releaseCapture&&n.target.releaseCapture(),r=new granit.PixelConverter(i.element[0]),this.panels.forEach(function(n){if(n.data().__granitData__.minimized=!1,n.data().__granitData__.maximized=!1,u=n.data().__granitData__.size,t=n.data().__granitData__.originalUnit,t!=="px"){var f=r.convertFromPixel(u,t,i.sizePropertyName);(t==="em"||t==="rem")&&n.css(i.sizePropertyName,f)}n.data().__granitData__.originalUnit!=="%"}),r.destroy(),this.panels.forEach(function(n){n.data().__granitData__.flexible&&n.removeClass("granit_Panel_Static")}),$("html").css("cursor","default"),this._off($("html"),"mousemove"),this._off($("html"),"mouseup"),this.MousemoveEventController&&this.MousemoveEventController.cancel(),this.movedSplitter=undefined)},_processPanelMovement:function(){function f(n,t){var f,r,i;if(!t.data().__granitData__.resizable)return null;if(n==="grow"){if(t.data().__granitData__.maximized===!0)return null;r=t.data().__granitData__.maxSize}if(n==="shrink"){if(t.data().__granitData__.minimized===!0)return null;r=t.data().__granitData__.minSize}return(i=t.data().__granitData__.size,n==="grow"&&(f=Math.min(i+Math.abs(u),r)),n==="shrink"&&(f=Math.max(i-Math.abs(u),r)),n==="grow"&&f>i&&i<r||n==="shrink"&&f<i&&i>r)?{panel:t,currentSize:i,limitSize:r,offset:Math.abs(i-f)}:null}var e,n,i,u,t,r;if(this.movedSplitter){if(e=this,u=this.currentMousePosition[this.coordinate]-this.movedSplitter.data().__granitData__.position,this.movedSplitter.data().__granitData__.position=this.currentMousePosition[this.coordinate],u>0){for(t=this.movedSplitter.prev().data().__granitData__.index;t>=0;t--)if(n=f("grow",this.panels[t]),n)break;if(n)for(t=this.movedSplitter.prev().data().__granitData__.index+1;t<this.panels.length;t++)if(i=f("shrink",this.panels[t]),i)break}if(u<0){for(t=this.movedSplitter.next().data().__granitData__.index;t<this.panels.length;t++)if(n=f("grow",this.panels[t]),n)break;if(n)for(t=this.movedSplitter.next().data().__granitData__.index-1;t>=0;t--)if(i=f("shrink",this.panels[t]),i)break}n&&i&&(r=Math.min(n.offset,i.offset),r>=1&&(i.panel.css(e.sizePropertyName,i.currentSize-r+"px"),n.panel.css(e.sizePropertyName,n.currentSize+r+"px"),i.panel.data().__granitData__.size=i.currentSize-r,i.panel.data().__granitData__.maximized=!1,n.panel.data().__granitData__.size=n.currentSize+r,n.panel.data().__granitData__.minimized=!1),i.currentSize-r<=i.limitSize&&(i.panel.data().__granitData__.minimized=!0),n.currentSize+r>=n.limitSize&&(n.panel.data().__granitData__.maximized=!0))}}})});